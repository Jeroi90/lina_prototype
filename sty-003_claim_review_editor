<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¼ì´ë‚˜ON íšŒë³µ í›„ê¸° ì‘ì„±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: {
                            blue: '#0055B8',
                            orange: '#F97316',
                            text: '#111827',
                            bg: '#F8F9FA',
                            red: '#DC2626'
                        }
                    },
                    fontFamily: {
                        sans: ['"Noto Sans KR"', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style>
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        .fade-in { animation: fadeIn 0.5s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .chip-btn { border: 1px solid #E5E7EB; background-color: #FFFFFF; color: #4B5563; transition: all 0.2s; }
        .chip-active-pos { background-color: #FFF7ED !important; border-color: #F97316 !important; color: #C2410C !important; font-weight: 700; box-shadow: 0 1px 2px rgba(249, 115, 22, 0.1); }
        .chip-active-neg { background-color: #FEF2F2 !important; border-color: #DC2626 !important; color: #B91C1C !important; font-weight: 700; box-shadow: 0 1px 2px rgba(220, 38, 38, 0.1); }

        .input-box:focus { outline: none; }
        .focus-pos:focus { border-color: #F97316; box-shadow: 0 0 0 1px #F97316; }
        .focus-neg:focus { border-color: #DC2626; box-shadow: 0 0 0 1px #DC2626; }

        .toggle-checkbox:checked { right: 0; border-color: #F97316; }
        .toggle-checkbox:checked + .toggle-label { background-color: #F97316; }
        
        .hosp-tag-active { background-color: #FFF7ED; border-color: #F97316; color: #C2410C; font-weight: 700; }

        .modal { transition: opacity 0.2s ease-out; }
        .modal.hidden { opacity: 0; pointer-events: none; }
        .modal-scale { transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1); }
        .modal.hidden .modal-scale { transform: translateY(100%); }
        .modal:not(.hidden) .modal-scale { transform: translateY(0); }

        #progress-bar { transition: width 0.1s linear; }
        .consent-btn-active { background-color: #F97316 !important; color: white !important; border-color: #F97316 !important; }
        
        body { display: flex; justify-content: center; align-items: center; min-height: 100vh; background-color: #f3f4f6; }
    </style>
</head>
<body>

    <div class="w-full max-w-[480px] bg-white relative flex flex-col h-[844px] shadow-2xl overflow-hidden rounded-[30px] border border-gray-200">

        <header class="h-14 px-5 flex items-center justify-between border-b border-gray-100 bg-white z-10 sticky top-0">
            <button class="w-8 h-8 flex items-center justify-start text-gray-800" onclick="history.back()"><i class="fas fa-times text-lg"></i></button>
            <h1 class="font-bold text-[17px] tracking-tight">íšŒë³µ í›„ê¸° ì‘ì„±</h1>
            <div class="w-8"></div>
        </header>

        <div class="flex-1 overflow-y-auto no-scrollbar pb-32 bg-brand-bg scroll-smooth" id="scroll-container">
            
            <section class="px-5 py-5 bg-white border-b border-gray-100 mb-2">
                <div class="flex items-start gap-3">
                    <div class="w-10 h-10 rounded-full bg-orange-50 border border-orange-100 flex items-center justify-center text-brand-orange flex-shrink-0"><i class="fas fa-file-invoice-dollar text-lg"></i></div>
                    <div class="flex-1">
                        <div class="flex justify-between items-start">
                            <div>
                                <span class="text-[11px] text-gray-500 font-bold block mb-0.5 tracking-tight">ë³´í—˜ê¸ˆ ì§€ê¸‰ í•­ëª©</span>
                                <h2 class="font-bold text-gray-900 text-[15px] leading-tight mb-1">ì¹˜ì£¼ì§ˆí™˜(ì‡ëª¸) ì¹˜ë£Œ ê¸‰ì—¬ê¸ˆ</h2>
                            </div>
                            <span class="bg-blue-50 text-brand-blue text-[10px] font-bold px-2 py-1 rounded-md border border-blue-100 flex items-center shadow-sm"><i class="fas fa-bolt mr-1"></i>24ì‹œê°„ ë‚´ ì§€ê¸‰</span>
                        </div>
                        <p class="text-[11px] text-gray-400 mt-1">ì§€ê¸‰ì¼ 2024.12.10</p>
                    </div>
                </div>
            </section>

            <section class="px-5 py-8 bg-white mb-2 text-center fade-in">
                <label class="block font-bold text-[18px] mb-4 text-gray-900">ë³´í—˜ê¸ˆì„ ì§€ê¸‰ ë°›ìœ¼ì‹  í›„ <br>ê¸°ë¶„ì„ ì•Œë ¤ì£¼ì„¸ìš”.</label>
                <div class="flex justify-center gap-3 mb-4" id="star-container">
                    <i onclick="setRating(1)" class="fa-solid fa-star text-4xl text-gray-200 cursor-pointer transition-transform active:scale-90 p-1"></i>
                    <i onclick="setRating(2)" class="fa-solid fa-star text-4xl text-gray-200 cursor-pointer transition-transform active:scale-90 p-1"></i>
                    <i onclick="setRating(3)" class="fa-solid fa-star text-4xl text-gray-200 cursor-pointer transition-transform active:scale-90 p-1"></i>
                    <i onclick="setRating(4)" class="fa-solid fa-star text-4xl text-gray-200 cursor-pointer transition-transform active:scale-90 p-1"></i>
                    <i onclick="setRating(5)" class="fa-solid fa-star text-4xl text-gray-200 cursor-pointer transition-transform active:scale-90 p-1"></i>
                </div>
                <div class="h-6"><span id="rating-text" class="text-[14px] font-bold transition-all duration-300"></span></div>
            </section>

            <div id="dynamic-content-area"></div>

            <section id="sec-hospital" class="px-5 py-6 bg-white mb-2 fade-in hidden">
                <div class="flex items-center justify-between">
                    <div>
                        <div class="flex items-center gap-2">
                            <span class="text-brand-orange font-bold text-lg">Plus.</span>
                            <h3 class="font-bold text-[16px] text-gray-900">ë³‘ì› í›„ê¸°</h3>
                            <span class="bg-gray-100 text-gray-500 text-[10px] font-bold px-2 py-0.5 rounded-full border border-gray-200">ì„ íƒ</span>
                        </div>
                        <p class="text-[12px] text-gray-500 mt-1 font-medium">ë‹¤ë…€ì˜¤ì‹  ë³‘ì›ì€ ì–´ë– ì…¨ë‚˜ìš”?</p>
                    </div>
                    <div class="relative inline-block w-12 align-middle select-none transition duration-200 ease-in">
                        <input type="checkbox" name="toggle" id="hospital-toggle" class="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer transition-all duration-200 ease-in-out left-0"/>
                        <label for="hospital-toggle" class="toggle-label block overflow-hidden h-6 rounded-full bg-gray-300 cursor-pointer transition-all duration-200 ease-in-out"></label>
                    </div>
                </div>
                <div id="hospital-content" class="hidden mt-5 pt-5 border-t border-gray-100 space-y-5">
                    <div class="bg-white rounded-2xl border border-gray-200 shadow-sm p-5 relative overflow-hidden">
                        <div class="absolute top-0 left-0 bg-teal-500 text-white text-[10px] font-bold px-3 py-1 rounded-br-lg z-10 shadow-sm"><i class="fas fa-bolt mr-1"></i> ë¼ì´ë‚˜ ì„œë¥˜ì œë¡œ ë³‘ì›</div>
                        <div class="flex items-start gap-3 mt-4 mb-2">
                            <div class="w-12 h-12 rounded-xl bg-gray-50 border border-gray-100 flex items-center justify-center text-gray-400 text-xl"><i class="fas fa-hospital-alt"></i></div>
                            <div>
                                <h4 class="font-bold text-gray-900 text-[16px]">ì‹ ì´Œì„¸ë¸Œë€ìŠ¤ë³‘ì›</h4>
                                <p class="text-[12px] text-gray-500 mt-0.5 font-medium">ì„œìš¸ ì„œëŒ€ë¬¸êµ¬ ì—°ì„¸ë¡œ 50-1</p>
                            </div>
                        </div>
                    </div>
                    <div>
                        <p class="text-[13px] font-bold text-gray-800 mb-2">ì§„ë£Œ ë§Œì¡±ë„</p>
                        <div class="flex gap-2">
                            <i onclick="rateHospital(1)" class="hosp-star fa-solid fa-star text-2xl text-gray-200 cursor-pointer p-1"></i>
                            <i onclick="rateHospital(2)" class="hosp-star fa-solid fa-star text-2xl text-gray-200 cursor-pointer p-1"></i>
                            <i onclick="rateHospital(3)" class="hosp-star fa-solid fa-star text-2xl text-gray-200 cursor-pointer p-1"></i>
                            <i onclick="rateHospital(4)" class="hosp-star fa-solid fa-star text-2xl text-gray-200 cursor-pointer p-1"></i>
                            <i onclick="rateHospital(5)" class="hosp-star fa-solid fa-star text-2xl text-gray-200 cursor-pointer p-1"></i>
                        </div>
                    </div>
                    <input type="text" class="w-full bg-white border border-gray-200 rounded-xl px-4 py-3 text-[13px] font-medium focus:outline-none focus:border-orange-500 transition-colors placeholder-gray-400" placeholder="ë³‘ì›ì— ëŒ€í•œ í•œì¤„í‰ì„ ë‚¨ê²¨ì£¼ì„¸ìš”.">
                </div>
            </section>

            <section id="sec-consent" class="px-5 py-6 hidden">
                <div class="bg-gray-50 rounded-xl p-4 border border-gray-200 space-y-4">
                    <h4 class="text-[14px] font-bold text-gray-900 flex justify-between items-center">
                        ì•½ê´€ ë™ì˜
                        <span onclick="openUnifiedModal()" class="text-[12px] text-brand-orange underline font-normal cursor-pointer">ì „ì²´ë³´ê¸°</span>
                    </h4>
                    
                    <div class="space-y-4" onclick="openUnifiedModal()">
                        <div class="flex items-center gap-3 pointer-events-none">
                            <input type="checkbox" id="main-chk-privacy" class="w-4 h-4 text-orange-600 border-gray-300 rounded" disabled>
                            <label class="text-[13px] text-gray-800 font-medium leading-snug">
                                <span class="text-orange-600 font-bold">[í•„ìˆ˜]</span> ê°œì¸ì •ë³´ ìˆ˜ì§‘ ë° ì´ìš© ë™ì˜
                            </label>
                        </div>
                        <div class="flex items-center gap-3 pointer-events-none">
                            <input type="checkbox" id="main-chk-sensitive" class="w-4 h-4 text-orange-600 border-gray-300 rounded" disabled>
                            <label class="text-[13px] text-gray-800 font-medium leading-snug">
                                <span class="text-orange-600 font-bold">[í•„ìˆ˜]</span> ë¯¼ê°ì •ë³´ ìˆ˜ì§‘ ë° ì´ìš© ë™ì˜
                            </label>
                        </div>
                        <div class="h-px bg-gray-200"></div>
                        
                        <div class="pointer-events-none">
                            <div class="flex items-center gap-3">
                                <input type="checkbox" id="main-chk-marketing" class="w-4 h-4 text-orange-600 border-gray-300 rounded" disabled>
                                <label class="text-[13px] text-gray-800 font-medium leading-snug">
                                    <span class="text-gray-400 font-bold">[ì„ íƒ]</span> ë§ˆì¼€íŒ… í™œìš© ë° ê´‘ê³ ì„± ì •ë³´ ìˆ˜ì‹ 
                                </label>
                            </div>
                            <p class="text-[11px] text-gray-400 pl-7 mt-1 leading-snug">ğŸ ì´ë²¤íŠ¸ ë‹¹ì²¨ ì†Œì‹ê³¼ ë¼ì´ë‚˜ON ì˜ ìƒˆë¡œìš´ ì´ë²¤íŠ¸,ì½˜í…ì¸ ë¥¼ ì•±í‘¸ì‹œë¡œ ê°„í¸í•˜ê²Œ ë°›ì•„ë³´ì„¸ìš”.</p>
                        </div>
                    </div>
                </div>
            </section>

        </div>

        <div class="absolute bottom-0 w-full bg-white border-t border-gray-100 p-5 pb-8 z-20 shadow-[0_-5px_30px_rgba(0,0,0,0.04)]">
            <button id="submit-btn" class="w-full py-4 rounded-xl font-bold text-[16px] transition-all bg-gray-200 text-gray-400 cursor-not-allowed" disabled onclick="submitReview()">
                í•„ìˆ˜ í•­ëª©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”
            </button>
        </div>

        <div id="unified-modal" class="modal hidden absolute inset-0 z-50">
            <div class="absolute inset-0 bg-black/60 transition-opacity" onclick="closeUnifiedModal()"></div>
            <div class="modal-scale absolute bottom-0 w-full bg-white rounded-t-[24px] h-[90%] flex flex-col transition-transform duration-300">
                
                <div class="relative shrink-0 bg-white rounded-t-[24px] z-10 border-b border-gray-100">
                    <div class="h-16 flex items-center justify-between px-5">
                        <h3 class="font-bold text-[17px] text-gray-900">ì•½ê´€ ì „ì²´ ë™ì˜</h3>
                        <button onclick="closeUnifiedModal()" class="text-gray-400 p-2"><i class="fas fa-times text-xl"></i></button>
                    </div>
                    <div class="h-1 bg-gray-100 w-full absolute bottom-0 left-0">
                        <div id="progress-bar" class="h-full bg-brand-orange w-0"></div>
                    </div>
                </div>

                <div class="flex-1 overflow-y-auto p-5 pb-10 bg-gray-50 space-y-8" id="term-scroll-view" onscroll="updateProgress()">
                    
                    <div class="bg-white p-5 rounded-2xl border border-gray-200 shadow-sm" id="sec-term-privacy">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="font-bold text-[15px] text-gray-900">ê°œì¸ì •ë³´ ìˆ˜ì§‘ ë° ì´ìš© ë™ì˜ <span class="text-brand-orange text-xs ml-1">[í•„ìˆ˜]</span></h4>
                        </div>
                        <div class="text-[12px] text-gray-500 leading-relaxed bg-gray-50 p-3 rounded-lg border border-gray-100 h-40 overflow-y-auto mb-4 no-scrollbar">
                            1. ëª©ì : í›„ê¸° ì„œë¹„ìŠ¤ ìš´ì˜, ê²½í’ˆ ë°œì†¡<br>2. í•­ëª©: ì„±ëª…, ì „í™”ë²ˆí˜¸, í›„ê¸° ë‚´ìš©<br>3. ë³´ìœ ê¸°ê°„: ì„œë¹„ìŠ¤ ì¢…ë£Œ ì‹œê¹Œì§€
                        </div>
                        <div class="flex gap-2">
                            <button onclick="setConsent('privacy', false)" id="btn-privacy-disagree" class="flex-1 py-3 rounded-xl border border-gray-200 text-gray-500 text-[13px] font-bold bg-white transition-colors">ë™ì˜í•˜ì§€ ì•ŠìŒ</button>
                            <button onclick="setConsent('privacy', true)" id="btn-privacy-agree" class="flex-1 py-3 rounded-xl border border-gray-200 text-gray-500 text-[13px] font-bold bg-white transition-colors">ë™ì˜</button>
                        </div>
                    </div>

                    <div class="bg-white p-5 rounded-2xl border border-gray-200 shadow-sm" id="sec-term-sensitive">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="font-bold text-[15px] text-gray-900">ë¯¼ê°ì •ë³´ ìˆ˜ì§‘ ë° ì´ìš© ë™ì˜ <span class="text-brand-orange text-xs ml-1">[í•„ìˆ˜]</span></h4>
                        </div>
                        <div class="text-[12px] text-gray-500 leading-relaxed bg-gray-50 p-3 rounded-lg border border-gray-100 h-40 overflow-y-auto mb-4 no-scrollbar">
                            1. ëª©ì : ë§ì¶¤í˜• í›„ê¸° ì œê³µ<br>2. í•­ëª©: ì§„ë‹¨ëª…, ì¹˜ë£Œ ë‚´ìš© ë“±<br>3. ë³´ìœ ê¸°ê°„: ì„œë¹„ìŠ¤ ì¢…ë£Œ ì‹œê¹Œì§€
                        </div>
                        <div class="flex gap-2">
                            <button onclick="setConsent('sensitive', false)" id="btn-sensitive-disagree" class="flex-1 py-3 rounded-xl border border-gray-200 text-gray-500 text-[13px] font-bold bg-white transition-colors">ë™ì˜í•˜ì§€ ì•ŠìŒ</button>
                            <button onclick="setConsent('sensitive', true)" id="btn-sensitive-agree" class="flex-1 py-3 rounded-xl border border-gray-200 text-gray-500 text-[13px] font-bold bg-white transition-colors">ë™ì˜</button>
                        </div>
                    </div>

                    <div class="bg-white p-5 rounded-2xl border border-gray-200 shadow-sm" id="sec-term-marketing">
                        <div class="mb-3">
                            <h4 class="font-bold text-[15px] text-gray-900">ë§ˆì¼€íŒ… í™œìš© ë° ê´‘ê³  ìˆ˜ì‹  ë™ì˜ <span class="text-gray-400 text-xs ml-1">[ì„ íƒ]</span></h4>
                            <p class="text-[11px] text-gray-400 mt-1">ğŸ ë‹¹ì²¨ ì†Œì‹ê³¼ ê²½í’ˆ ì§€ê¸‰ì„ ìœ„í•´ ë™ì˜ê°€ í•„ìš”í•´ìš”.</p>
                        </div>
                        <div class="text-[12px] text-gray-500 leading-relaxed bg-gray-50 p-3 rounded-lg border border-gray-100 h-32 overflow-y-auto mb-4 no-scrollbar">
                            1. ëª©ì : í˜œíƒ ì •ë³´ ì•ˆë‚´<br>2. í•­ëª©: ì—°ë½ì²˜, ì•± í‘¸ì‹œ í† í°<br>3. ë³´ìœ ê¸°ê°„: ì² íšŒ ì‹œê¹Œì§€
                        </div>
                        <div class="flex gap-2">
                            <button onclick="setConsent('marketing', false)" id="btn-marketing-disagree" class="flex-1 py-3 rounded-xl border border-gray-200 text-gray-500 text-[13px] font-bold bg-white transition-colors consent-btn-active">ë™ì˜í•˜ì§€ ì•ŠìŒ</button>
                            <button onclick="setConsent('marketing', true)" id="btn-marketing-agree" class="flex-1 py-3 rounded-xl border border-gray-200 text-gray-500 text-[13px] font-bold bg-white transition-colors">ë™ì˜</button>
                        </div>
                    </div>

                    <div class="h-10"></div>
                </div>

                <div class="p-5 border-t border-gray-100 bg-white pb-8">
                    <button id="modal-confirm-btn" onclick="confirmUnifiedModal()" class="w-full py-4 bg-gray-200 text-gray-400 font-bold rounded-xl text-[15px] cursor-not-allowed shadow-none" disabled>
                        í•„ìˆ˜ í•­ëª©ì„ ì„ íƒí•´ì£¼ì„¸ìš”
                    </button>
                </div>
            </div>
        </div>

        <div id="care-modal" class="modal hidden fixed inset-0 z-50 flex items-center justify-center p-5">
            <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" onclick="closeCareModal()"></div>
            <div class="relative bg-white rounded-2xl shadow-2xl p-6 w-full max-w-[340px] text-center">
                <div class="w-12 h-12 rounded-full bg-red-50 text-brand-red flex items-center justify-center mx-auto mb-4 text-xl"><i class="fas fa-headset"></i></div>
                <h3 class="text-lg font-bold text-gray-900 mb-2">ë¶ˆí¸ì„ ë“œë ¤ ì£„ì†¡í•©ë‹ˆë‹¤</h3>
                <p class="text-[13px] text-gray-600 leading-relaxed mb-6">ì „ë¬¸ ìƒë‹´ì‚¬ì˜ ì•ˆë‚´ê°€ í•„ìš”í•˜ì‹ ê°€ìš”?</p>
                <div class="flex flex-col gap-2">
                    <button onclick="requestCallback()" class="w-full py-3 bg-brand-red text-white font-bold rounded-xl text-sm shadow-md">ë„¤, ìƒë‹´ ìš”ì²­í• ê²Œìš”</button>
                    <button onclick="completeSubmission()" class="w-full py-3 bg-white text-gray-500 font-medium rounded-xl text-sm border border-gray-200">ê´œì°®ìŠµë‹ˆë‹¤</button>
                </div>
            </div>
        </div>

    </div>

    <script>
        function autoResize(textarea) {
            textarea.style.height = 'auto'; textarea.style.height = textarea.scrollHeight + 'px';
            const counter = textarea.parentNode.querySelector('.text-cnt');
            if (counter) counter.innerText = textarea.value.length;
            checkAllInputs();
        }

        const templates = {
            positive: `
                <section class="px-5 py-6 bg-white mb-2 fade-in" id="step-1">
                    <label class="block font-bold text-[15px] mb-3"><span class="text-brand-orange mr-1">Step 1.</span> ì´ë²ˆ ë³´í—˜ê¸ˆ ì§€ê¸‰ì´<br>ì–´ë–¤ ë„ì›€ì´ ë˜ì—ˆë‚˜ìš”? <span class="text-gray-400 text-[11px] font-normal ml-1"><br>(ì—¬ëŸ¬ê°œ ì„ íƒí•  ìˆ˜ ìˆì–´ìš”)</span></label>
                    <div class="flex flex-wrap gap-2 chip-group" id="chip-group-1">
                        <button onclick="toggleChip(this)" class="chip-btn px-3 py-2 rounded-lg text-[13px] font-medium">ğŸ’¸ ì¹˜ë£Œë¹„ ë¶€ë‹´ í•´ê²°</button>
                        <button onclick="toggleChip(this)" class="chip-btn px-3 py-2 rounded-lg text-[13px] font-medium">ğŸ’Š ì•½ê°’/ê²€ì‚¬ë¹„ í™œìš©</button>
                        <button onclick="toggleChip(this)" class="chip-btn px-3 py-2 rounded-lg text-[13px] font-medium">ğŸ›’ ìƒí™œë¹„ ë³´íƒ¬</button>
                        <button onclick="toggleChip(this)" class="chip-btn px-3 py-2 rounded-lg text-[13px] font-medium">ğŸ¥£ ê°„ë³‘/ìš”ì–‘ë¹„ ì‚¬ìš©</button>
                    </div>
                </section>
                <section class="px-5 py-6 bg-white mb-2 fade-in hidden" id="step-2">
                    <label class="block font-bold text-[15px] mb-3"><span class="text-brand-orange mr-1">Step 2.</span> í˜„ì¬ ì¹˜ë£Œ ìƒí™©ì€<br>ì–´ë– ì‹ ê°€ìš”? <span class="text-gray-400 text-[11px] font-normal ml-1"><br>(ì—¬ëŸ¬ê°œ ì„ íƒí•  ìˆ˜ ìˆì–´ìš”)</span></label>
                    <div class="flex flex-wrap gap-2 chip-group" id="chip-group-2">
                        <button onclick="toggleChip(this, 2)" class="chip-btn px-3 py-2 rounded-lg text-[13px] font-medium">ğŸ¥ ìˆ˜ìˆ /ì‹œìˆ  ì™„ë£Œ</button>
                        <button onclick="toggleChip(this, 2)" class="chip-btn px-3 py-2 rounded-lg text-[13px] font-medium">ğŸ’‰ ê¾¸ì¤€í•œ í†µì› ì¹˜ë£Œ ì¤‘</button>
                        <button onclick="toggleChip(this, 2)" class="chip-btn px-3 py-2 rounded-lg text-[13px] font-medium">ğŸ” ì¡°ê¸° ë°œê²¬í•˜ì—¬ ê´€ë¦¬</button>
                        <button onclick="toggleChip(this, 2)" class="chip-btn px-3 py-2 rounded-lg text-[13px] font-medium">ğŸ’ª ê±´ê°•í•˜ê²Œ íšŒë³µ ì™„ë£Œ</button>
                    </div>
                </section>
                <section class="px-5 py-6 bg-white mb-2 fade-in hidden" id="step-3">
                    <h3 class="font-bold text-[16px] mb-1"><span class="text-brand-orange mr-1">Step 3.</span> ì´ì•¼ê¸°ë¥¼ ì¢€ë” ìì„¸íˆ ë“¤ë ¤ì£¼ì„¸ìš”</h3>
                    <p class="text-[12px] text-gray-400 mb-4">ìµœì†Œ 10ì ì´ìƒ ì‘ì„±í•´ ì£¼ì„¸ìš”.</p>
                    <div class="bg-gray-50 border border-gray-200 rounded-xl p-4 mb-6">
                        <h4 class="text-[12px] font-bold text-gray-700 mb-2 flex items-center gap-1.5"><i class="fas fa-exclamation-circle text-orange-400"></i> ì‘ì„± ì‹œ ìœ ì˜ì‚¬í•­</h4>
                        <ul class="text-[11px] text-gray-500 space-y-1.5 list-disc list-inside leading-snug">
                            <li>ê°œì¸ì •ë³´(ì£¼ë¯¼ë²ˆí˜¸, ì „í™”ë²ˆí˜¸ ë“±)ëŠ” ì ˆëŒ€ ì…ë ¥í•˜ì§€ ë§ˆì„¸ìš”.</li>
                            <li>ì˜ë£Œë²•ìƒ íŠ¹ì • ë³‘ì›ì˜ í™ë³´ë‚˜ ìœ ì¸ ì•Œì„ ìœ¼ë¡œ ì˜¤ì¸ë  ìˆ˜ ìˆëŠ” ë‚´ìš©ì€ ì„ì˜ ìˆ˜ì •ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
                            <li>ì‘ì„±ëœ ë‚´ìš©ì€ ë¼ì´ë‚˜ìƒëª…ì˜ ì„œë¹„ìŠ¤ ê°œì„  ë° í™ë³´ ëª©ì ìœ¼ë¡œ í™œìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
                        </ul>
                    </div>
                    <div class="mb-6 relative pl-8">
                        <div class="absolute left-0 top-0 w-6 h-6 rounded-full bg-orange-100 text-brand-orange flex items-center justify-center text-[10px] font-bold">1</div>
                        <label class="block text-[13px] font-bold text-gray-800 mb-2 pt-1">ì–´ë””ê°€ ì•„í”„ì…¨ë‚˜ìš”?</label>
                        <textarea id="text-1" class="input-box focus-pos w-full min-h-[80px] bg-gray-50 border border-gray-200 rounded-xl p-3 text-[14px] resize-none overflow-hidden placeholder-gray-400 leading-relaxed" 
                        placeholder="ì˜ˆ) ë¹™íŒê¸¸ì—ì„œ ë„˜ì–´ì ¸ ì†ëª©ì„ ë‹¤ì³¤ì–´ìš”. / ê±´ê°•ê²€ì§„ ì¤‘ ìš©ì¢…ì´ ë°œê²¬ë˜ì—ˆì–´ìš”." 
                        maxlength="1000" oninput="autoResize(this)"></textarea>
                        <div class="text-right text-[10px] text-gray-400 mt-1"><span class="text-cnt">0</span>/1000ì (ìµœì†Œ 10ì)</div>
                    </div>
                    <div class="mb-6 relative pl-8">
                        <div class="absolute left-0 top-0 w-6 h-6 rounded-full bg-orange-100 text-brand-orange flex items-center justify-center text-[10px] font-bold">2</div>
                        <label class="block text-[13px] font-bold text-gray-800 mb-2 pt-1">ì¹˜ë£Œ ê³¼ì •ê³¼ í˜„ì¬ ìƒíƒœëŠ”ìš”?</label>
                        <textarea id="text-2" class="input-box focus-pos w-full min-h-[80px] bg-gray-50 border border-gray-200 rounded-xl p-3 text-[14px] resize-none overflow-hidden placeholder-gray-400 leading-relaxed" 
                        placeholder="ì˜ˆ) ìˆ˜ìˆ  í›„ ì¼ì£¼ì¼ ì •ë„ ì…ì› ì¹˜ë£Œë¥¼ ë°›ì•˜ê³ , ì§€ê¸ˆì€ í‡´ì›í•´ì„œ ë§ì´ íšŒë³µë˜ì—ˆìŠµë‹ˆë‹¤." 
                        maxlength="1000" oninput="autoResize(this)"></textarea>
                        <div class="text-right text-[10px] text-gray-400 mt-1"><span class="text-cnt">0</span>/1000ì (ìµœì†Œ 10ì)</div>
                    </div>
                    <div class="mb-6 relative pl-8">
                        <div class="absolute left-0 top-0 w-6 h-6 rounded-full bg-orange-100 text-brand-orange flex items-center justify-center text-[10px] font-bold">3</div>
                        <label class="block text-[13px] font-bold text-gray-800 mb-2 pt-1">ë³´í—˜ê¸ˆ ì§€ê¸‰ì´ ë„ì›€ì´ ë˜ì…¨ë‚˜ìš”?</label>
                        <textarea id="text-3" class="input-box focus-pos w-full min-h-[80px] bg-gray-50 border border-gray-200 rounded-xl p-3 text-[14px] resize-none overflow-hidden placeholder-gray-400 leading-relaxed" 
                        placeholder="ì˜ˆ) ê¸‰í•˜ê²Œ ëª©ëˆì´ í•„ìš”í–ˆëŠ”ë°, ì²­êµ¬ ë‹¤ìŒë‚  ë°”ë¡œ ì…ê¸ˆë˜ì–´ ë³‘ì›ë¹„ ê²°ì œì— í° ë„ì›€ì´ ëì–´ìš”." 
                        maxlength="1000" oninput="autoResize(this)"></textarea>
                        <div class="text-right text-[10px] text-gray-400 mt-1"><span class="text-cnt">0</span>/1000ì (ìµœì†Œ 10ì)</div>
                    </div>
                    <div class="mb-2 relative pl-8">
                        <div class="absolute left-0 top-0 w-6 h-6 rounded-full bg-teal-100 text-brand-blue flex items-center justify-center text-[10px] font-bold"><i class="fas fa-heart"></i></div>
                        <label class="block text-[13px] font-bold text-gray-800 mb-2 pt-1">ë¼ì´ë‚˜ ê°€ì¡±ë“¤ì—ê²Œ í•œë§ˆë””!</label>
                        <textarea id="text-4" class="input-box focus-pos w-full min-h-[80px] bg-gray-50 border border-gray-200 rounded-xl p-3 text-[14px] resize-none overflow-hidden placeholder-gray-400 leading-relaxed" 
                        placeholder="ì˜ˆ) ì•„í”„ë©´ ì°¸ì§€ ë§ê³  ë°”ë¡œ ë³‘ì›ì— ê°€ì„¸ìš”! ë³´í—˜ì´ ìˆìœ¼ë‹ˆ ì •ë§ ë“ ë“ í•˜ë„¤ìš”." 
                        maxlength="1000" oninput="autoResize(this)"></textarea>
                        <div class="text-right text-[10px] text-gray-400 mt-1"><span class="text-cnt">0</span>/1000ì (ìµœì†Œ 10ì)</div>
                    </div>
                    
                    <div class="mt-4 flex items-start gap-3 bg-orange-50 p-3 rounded-xl border border-orange-100">
                        <input type="checkbox" id="chk-event-auto" class="mt-1 w-4 h-4 text-orange-600 border-gray-300 rounded focus:ring-orange-500" checked onchange="checkAllInputs()">
                        <label for="chk-event-auto" class="text-[13px] text-gray-800 font-bold leading-snug">
                            ë¼ì´ë‚˜ON BEST í›„ê¸° ì´ë²¤íŠ¸ ì°¸ê°€
                            <span class="block text-[11px] text-gray-500 font-normal mt-0.5">ì²´í¬ ì‹œ ì‘ì„±í•˜ì‹  í›„ê¸°ë¡œ ë§¤ì›” ì§„í–‰í•˜ëŠ” BEST í›„ê¸° ì„ ë°œ ì´ë²¤íŠ¸ì— ì°¸ì—¬í•˜ê²Œ ë©ë‹ˆë‹¤.<p> ë°°ë‹¬ì˜ë¯¼ì¡± ì¿ í° / ì»¤í”¼ì¿ í°ì„ ì´ë²¤íŠ¸ ë¦¬ì›Œë“œë¡œ ë“œë ¤ìš”.<p></span>
                            <button onclick="alert('ì´ë²¤íŠ¸ ìƒì„¸ í˜ì´ì§€ë¡œ ì´ë™')" class="text-[11px] text-brand-blue underline mt-1 font-medium">ìš°ìˆ˜ í›„ê¸° í˜œíƒ ìì„¸íˆ ë³´ê¸° ></button>
                        </label>
                    </div>
                </section>
            `,
            negative: `
                <section class="px-5 py-6 bg-white mb-2 fade-in" id="step-1">
                    <label class="block font-bold text-[15px] mb-3"><span class="text-brand-red mr-1">Step 1.</span> ì–´ë–¤ ì ì´ ë¶ˆí¸í•˜ì…¨ë‚˜ìš”?</label>
                    <div class="flex flex-wrap gap-2 chip-group" id="chip-group-1">
                        <button onclick="toggleChip(this)" class="chip-btn px-3 py-2 rounded-lg text-[13px] font-medium hover:border-red-300">ğŸ¢ ì§€ê¸‰ì´ ë„ˆë¬´ ëŠ¦ì–´ìš”</button>
                        <button onclick="toggleChip(this)" class="chip-btn px-3 py-2 rounded-lg text-[13px] font-medium hover:border-red-300">ğŸ“‰ ê¸ˆì•¡ì´ ì ì–´ìš”</button>
                        <button onclick="toggleChip(this)" class="chip-btn px-3 py-2 rounded-lg text-[13px] font-medium hover:border-red-300">ğŸ“„ ì„œë¥˜ ë³µì¡</button>
                        <button onclick="toggleChip(this)" class="chip-btn px-3 py-2 rounded-lg text-[13px] font-medium hover:border-red-300">ğŸ§ ì—°ê²° ì•ˆë¨</button>
                    </div>
                </section>
                <section class="px-5 py-6 bg-white mb-2 fade-in hidden" id="step-3">
                    <h3 class="font-bold text-[16px] mb-1"><span class="text-brand-red mr-1">Step 2.</span> ìƒì„¸ ë‚´ìš©ì„ ë‚¨ê²¨ì£¼ì„¸ìš”</h3>
                    <p class="text-[12px] text-gray-400 mb-4">ìµœì†Œ 10ì ì´ìƒ ì‘ì„±í•´ ì£¼ì„¸ìš”.</p>
                    <div class="bg-red-50 border border-red-100 rounded-xl p-4 mb-6">
                        <h4 class="text-[12px] font-bold text-red-700 mb-2"><i class="fas fa-exclamation-triangle"></i> ì‘ì„± ì „ í™•ì¸</h4>
                        <ul class="text-[11px] text-gray-600 list-disc list-inside"><li>ë¹„ë°©/ìš•ì„¤ ê¸ˆì§€</li><li>í—ˆìœ„ ì‚¬ì‹¤ ê¸ˆì§€</li></ul>
                    </div>
                    <div class="mb-6 relative pl-8">
                        <div class="absolute left-0 top-0 w-6 h-6 rounded-full bg-red-100 text-brand-red flex items-center justify-center text-[10px] font-bold">1</div>
                        <label class="block text-[13px] font-bold text-gray-800 mb-2 pt-1">êµ¬ì²´ì ìœ¼ë¡œ ì–´ë–¤ ìƒí™©ì´ì—ˆë‚˜ìš”?</label>
                        <textarea id="text-1" class="input-box focus-neg w-full min-h-[80px] bg-gray-50 border border-gray-200 rounded-xl p-3 text-[14px] resize-none overflow-hidden placeholder-gray-400 leading-relaxed" placeholder="ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”." maxlength="1000" oninput="autoResize(this)"></textarea>
                        <div class="text-right text-[10px] text-gray-400 mt-1"><span class="text-cnt">0</span>/1000ì (ìµœì†Œ 10ì)</div>
                    </div>
                    <div class="mb-2 relative pl-8">
                        <div class="absolute left-0 top-0 w-6 h-6 rounded-full bg-red-100 text-brand-red flex items-center justify-center text-[10px] font-bold">2</div>
                        <label class="block text-[13px] font-bold text-gray-800 mb-2 pt-1">ë¼ì´ë‚˜ì—ê²Œ ë°”ë¼ëŠ” ì ?</label>
                        <textarea id="text-2" class="input-box focus-neg w-full min-h-[80px] bg-gray-50 border border-gray-200 rounded-xl p-3 text-[14px] resize-none overflow-hidden placeholder-gray-400 leading-relaxed" placeholder="ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”." maxlength="1000" oninput="autoResize(this)"></textarea>
                        <div class="text-right text-[10px] text-gray-400 mt-1"><span class="text-cnt">0</span>/1000ì (ìµœì†Œ 10ì)</div>
                    </div>
                </section>
            `
        };

        let currentMode = null;
        let currentRating = 0;
        
        // Consent State Object (3 items now)
        const consentState = {
            privacy: null, // null = Not selected yet
            sensitive: null,
            marketing: false // Default Disagree
        };

        function setRating(score) {
            currentRating = score;
            const newMode = score <= 2 ? 'negative' : 'positive';
            const stars = document.getElementById('star-container').children;
            const textLabel = document.getElementById('rating-text');
            const texts = ["", "ë§ì´ ì•„ì‰¬ì› ì–´ìš” ğŸ˜¥", "ì¡°ê¸ˆ ì•„ì‰¬ì›Œìš”", "ë³´í†µì´ì—ìš” ğŸ™‚", "ì¢‹ì•˜ì–´ìš” ğŸ˜Š", "ìµœê³ ì—ìš”! ğŸ‘"];

            for (let i = 0; i < 5; i++) {
                stars[i].classList.toggle('text-yellow-400', i < score);
                stars[i].classList.toggle('text-gray-200', i >= score);
            }
            textLabel.innerText = texts[score];
            textLabel.className = `text-[14px] font-bold transition-all duration-300 ${newMode === 'negative' ? 'text-brand-red' : 'text-brand-orange'}`;

            if (currentMode !== newMode) {
                currentMode = newMode;
                document.getElementById('dynamic-content-area').innerHTML = templates[newMode];
                
                // Reset Sections
                document.getElementById('sec-hospital').classList.add('hidden');
                document.getElementById('sec-consent').classList.add('hidden');
                
                // Reset Submit Button
                const btn = document.getElementById('submit-btn');
                btn.disabled = true;
                btn.classList.add('bg-gray-200', 'text-gray-400', 'cursor-not-allowed');
                btn.classList.remove('bg-brand-orange', 'bg-brand-red', 'text-white', 'shadow-lg');
                btn.innerText = "í•„ìˆ˜ í•­ëª©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”";
            }
        }

        function toggleChip(btn, groupNum = 1) {
            const isNegative = currentMode === 'negative';
            const activeClass = isNegative ? 'chip-active-neg' : 'chip-active-pos';
            
            btn.classList.toggle(activeClass);
            btn.classList.toggle('border-transparent');

            if (isNegative) {
                const step3 = document.getElementById('step-3');
                const consent = document.getElementById('sec-consent');
                
                if (step3.classList.contains('hidden')) {
                    step3.classList.remove('hidden');
                    consent.classList.remove('hidden');
                    setTimeout(() => { step3.scrollIntoView({ behavior: 'smooth', block: 'start' }); }, 100);
                }
            } else {
                if (groupNum === 1) {
                    const step2 = document.getElementById('step-2');
                    if (step2 && step2.classList.contains('hidden')) {
                        step2.classList.remove('hidden');
                        setTimeout(() => { step2.scrollIntoView({ behavior: 'smooth', block: 'center' }); }, 100);
                    }
                } else {
                    const step3 = document.getElementById('step-3');
                    const hospital = document.getElementById('sec-hospital');
                    const consent = document.getElementById('sec-consent');
                    
                    if (step3 && step3.classList.contains('hidden')) {
                        step3.classList.remove('hidden');
                        hospital.classList.remove('hidden');
                        consent.classList.remove('hidden');
                        setTimeout(() => { step3.scrollIntoView({ behavior: 'smooth', block: 'start' }); }, 100);
                    }
                }
            }
            checkAllInputs();
        }

        document.addEventListener('change', function(e) {
            if(e.target && e.target.id == 'hospital-toggle'){
                const content = document.getElementById('hospital-content');
                if(e.target.checked) content.classList.remove('hidden');
                else content.classList.add('hidden');
            }
        });

        function rateHospital(value) {
            const stars = document.querySelectorAll('.hosp-star');
            stars.forEach((star, index) => {
                star.classList.toggle('text-yellow-400', index < value);
                star.classList.toggle('text-gray-200', index >= value);
            });
        }

        // --- 3. Unified Modal Logic ---
        function openUnifiedModal() {
            const modal = document.getElementById('unified-modal');
            modal.classList.remove('hidden');
            renderModalButtons();
            updateProgress();
            checkModalCompletion();
        }

        function closeUnifiedModal() {
            document.getElementById('unified-modal').classList.add('hidden');
            syncMainCheckboxes();
            checkAllInputs();
        }

        function updateProgress() {
            const container = document.getElementById('term-scroll-view');
            const scrollTop = container.scrollTop;
            const scrollHeight = container.scrollHeight - container.clientHeight;
            const percent = (scrollTop / scrollHeight) * 100;
            document.getElementById('progress-bar').style.width = Math.min(percent, 100) + '%';
        }

        function setConsent(type, isAgree) {
            consentState[type] = isAgree;
            renderModalButtons();
            checkModalCompletion();
        }

        function renderModalButtons() {
            const types = ['privacy', 'sensitive', 'marketing'];
            types.forEach(type => {
                const agreeBtn = document.getElementById(`btn-${type}-agree`);
                const disagreeBtn = document.getElementById(`btn-${type}-disagree`);
                const val = consentState[type];

                agreeBtn.classList.remove('consent-btn-active');
                disagreeBtn.classList.remove('consent-btn-active');

                if (val === true) agreeBtn.classList.add('consent-btn-active');
                else if (val === false) disagreeBtn.classList.add('consent-btn-active');
            });
        }

        function checkModalCompletion() {
            const btn = document.getElementById('modal-confirm-btn');
            const isPrivacyDone = consentState.privacy !== null;
            const isSensitiveDone = consentState.sensitive !== null;
            
            if (isPrivacyDone && isSensitiveDone) {
                btn.disabled = false;
                btn.classList.remove('bg-gray-200', 'text-gray-400', 'cursor-not-allowed');
                btn.classList.add('bg-brand-orange', 'text-white', 'shadow-lg');
                btn.innerText = "í™•ì¸ ë° ë‹«ê¸°";
            } else {
                btn.disabled = true;
                btn.classList.add('bg-gray-200', 'text-gray-400', 'cursor-not-allowed');
                btn.classList.remove('bg-brand-orange', 'text-white', 'shadow-lg');
                btn.innerText = "í•„ìˆ˜ í•­ëª©ì„ ì„ íƒí•´ì£¼ì„¸ìš”";
            }
        }

        function syncMainCheckboxes() {
            document.getElementById('main-chk-privacy').checked = consentState.privacy === true;
            document.getElementById('main-chk-sensitive').checked = consentState.sensitive === true;
            document.getElementById('main-chk-marketing').checked = consentState.marketing === true;
        }

        // --- 4. Main Validation ---
        function checkAllInputs() {
            const btn = document.getElementById('submit-btn');
            
            // Check Required Consents from STATE
            const isConsentValid = consentState.privacy && consentState.sensitive;

            let isValid = false;

            const validateField = (id) => {
                const el = document.getElementById(id);
                if (!el) return false; 
                
                const len = el.value.trim().length;
                if(len > 0 && len < 10) {
                    el.classList.add('border-red-300', 'bg-red-50');
                    el.classList.remove('border-gray-200', 'bg-gray-50');
                } else {
                    el.classList.remove('border-red-300', 'bg-red-50');
                    el.classList.add('border-gray-200', 'bg-gray-50');
                }
                return len >= 10;
            };

            if (currentMode === 'positive') {
                const chip1 = document.getElementById('chip-group-1')?.querySelectorAll('.chip-active-pos').length > 0;
                const chip2 = document.getElementById('chip-group-2')?.querySelectorAll('.chip-active-pos').length > 0;
                const t1 = validateField('text-1');
                const t2 = validateField('text-2');
                const t3 = validateField('text-3');
                const t4 = validateField('text-4');
                
                isValid = chip1 && chip2 && t1 && t2 && t3 && t4 && isConsentValid;
                
                if(isValid) {
                    btn.classList.add('bg-brand-orange');
                    btn.classList.remove('bg-brand-red');
                }

            } else if (currentMode === 'negative') {
                const chip1 = document.getElementById('chip-group-1')?.querySelectorAll('.chip-active-neg').length > 0;
                const t1 = validateField('text-1');
                const t2 = validateField('text-2');
                
                isValid = chip1 && t1 && t2 && isConsentValid;
                
                if(isValid) {
                    btn.classList.add('bg-brand-red');
                    btn.classList.remove('bg-brand-orange');
                }
            }

            if (isValid) {
                btn.disabled = false;
                btn.classList.remove('bg-gray-200', 'text-gray-400', 'cursor-not-allowed');
                btn.classList.add('text-white', 'shadow-lg');
                btn.innerText = currentMode === 'negative' ? "ì˜ê²¬ ë³´ë‚´ê¸°" : "í›„ê¸° ë“±ë¡í•˜ê¸°";
            } else {
                btn.disabled = true;
                btn.classList.add('bg-gray-200', 'text-gray-400', 'cursor-not-allowed');
                btn.classList.remove('bg-brand-orange', 'bg-brand-red', 'text-white', 'shadow-lg');
                btn.innerText = "í•„ìˆ˜ í•­ëª©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”";
            }
        }

        // --- 5. Submission ---
        function submitReview() {
            if (currentMode === 'negative') {
                document.getElementById('care-modal').classList.remove('hidden');
            } else {
                alert("ì†Œì¤‘í•œ í›„ê¸°ê°€ ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!\nì°¸ì—¬í•´ ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤.");
            }
        }
        function closeCareModal() { document.getElementById('care-modal').classList.add('hidden'); }
        function requestCallback() { closeCareModal(); alert("ìƒë‹´ ì˜ˆì•½ ì™„ë£Œ"); }
        function completeSubmission() { closeCareModal(); alert("ë“±ë¡ ì™„ë£Œ"); }

    </script>
</body>
</html>
